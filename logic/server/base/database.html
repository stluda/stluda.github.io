
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>数据库管理类 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-luda-toggle-chapters/luda-toggle-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-luda-sticky-header/luda-sticky-header.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="database/sqltask.html" />
    
    
    <link rel="prev" href="queryexp/exp2.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../">
            
                <a href="../../../">
            
                    
                    前言
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../../../intro/what.html">
            
                <a href="../../../intro/what.html">
            
                    
                    项目介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../../intro.html">
            
                <a href="../../../intro.html">
            
                    
                    使用说明
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../../manual/query.html">
            
                <a href="../../../manual/query.html">
            
                    
                    查询
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../../manual/task.html">
            
                <a href="../../../manual/task.html">
            
                    
                    任务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../../manual/other.html">
            
                <a href="../../../manual/other.html">
            
                    
                    其他
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../../logic.html">
            
                <a href="../../../logic.html">
            
                    
                    程序架构&核心源码
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../server.html">
            
                <a href="../../server.html">
            
                    
                    服务端
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../clawer.html">
            
                <a href="../clawer.html">
            
                    
                    信息抓取模块
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1.1" data-path="../clawer/spider.html">
            
                <a href="../clawer/spider.html">
            
                    
                    爬虫子模块
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1.1.1" data-path="../clawer/spider/tactics.html">
            
                <a href="../clawer/spider/tactics.html">
            
                    
                    抓取策略
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.1.1.2" data-path="../clawer/spider/continue.html">
            
                <a href="../clawer/spider/continue.html">
            
                    
                    续做功能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.1.1.3" data-path="../clawer/spider/firstpage.html">
            
                <a href="../clawer/spider/firstpage.html">
            
                    
                    第1页判断
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.1.1.2" data-path="../clawer/parser.html">
            
                <a href="../clawer/parser.html">
            
                    
                    数据解析子模块
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../server.html">
            
                <a href="../server.html">
            
                    
                    请求处理模块
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.2.1" data-path="../server/receiver.html">
            
                <a href="../server/receiver.html">
            
                    
                    接收线程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2.2" data-path="../server/worker.html">
            
                <a href="../server/worker.html">
            
                    
                    工作线程池
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2.3" data-path="../server/biz.html">
            
                <a href="../server/biz.html">
            
                    
                    请求处理(节选)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../hunter.html">
            
                <a href="../hunter.html">
            
                    
                    任务处理模块
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../model.html">
            
                <a href="../model.html">
            
                    
                    数据访问层
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.4.1" data-path="../model/job.html">
            
                <a href="../model/job.html">
            
                    
                    职位类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4.2" data-path="../model/user.html">
            
                <a href="../model/user.html">
            
                    
                    用户类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4.3" data-path="../model/session.html">
            
                <a href="../model/session.html">
            
                    
                    会话类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4.4" data-path="../model/queryresult.html">
            
                <a href="../model/queryresult.html">
            
                    
                    查询结果类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4.5" data-path="../model/task.html">
            
                <a href="../model/task.html">
            
                    
                    任务类
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4.6" data-path="../model/clawresult.html">
            
                <a href="../model/clawresult.html">
            
                    
                    抓取结果类
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.1.5" data-path="../base.html">
            
                <a href="../base.html">
            
                    
                    公共组件
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.5.1" data-path="queryexp.html">
            
                <a href="queryexp.html">
            
                    
                    查询表达式编译器
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.5.1.1" data-path="queryexp/exp1.html">
            
                <a href="queryexp/exp1.html">
            
                    
                    关键词编译器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.5.1.2" data-path="queryexp/exp2.html">
            
                <a href="queryexp/exp2.html">
            
                    
                    表达式编译器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.3.1.5.2" data-path="database.html">
            
                <a href="database.html">
            
                    
                    数据库管理类
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.5.2.1" data-path="database/sqltask.html">
            
                <a href="database/sqltask.html">
            
                    
                    SQL任务
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.1.5.3" data-path="threadpool.html">
            
                <a href="threadpool.html">
            
                    
                    线程池
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../client.html">
            
                <a href="../../client.html">
            
                    
                    客户端
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../../postscript.html">
            
                <a href="../../../postscript.html">
            
                    
                    后记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    附录
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../../manual/query/exp.html">
            
                <a href="../../../manual/query/exp.html">
            
                    
                    查询表达式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../proto.html">
            
                <a href="../../proto.html">
            
                    
                    通讯协议
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../../proto/protobuf.html">
            
                <a href="../../proto/protobuf.html">
            
                    
                    Protobuf
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../../about.html">
            
                <a href="../../../about.html">
            
                    
                    联系方式
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../.." >数据库管理类</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x7C7B;">&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x7C7B;</h2>
<p>&#x8BF4;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x7A0B;&#x5E8F;&#x603B;&#x662F;&#x79BB;&#x4E0D;&#x5F00;&#x6570;&#x636E;&#x5E93;&#x3002;&#x5355;&#x7EAF;&#x53EA;&#x662F;&#x8981;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x5E93;&#x662F;&#x5F88;&#x7B80;&#x5355;&#x7684;&#xFF0C;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x63D0;&#x4EA4;&#x8BED;&#x53E5;&#xFF0C;&#x6267;&#x884C;&#xFF0C;&#x65AD;&#x5F00;&#x6570;&#x636E;&#x5E93;&#x5C31;&#x5B8C;&#x4E8B;&#x4E86;&#x3002;</p>
<p>&#x4F46;&#x662F;&#xFF0C;&#x6BCF;&#x6B21;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x5E93;&#x90FD;&#x8981;&#x5199;&#x8FD9;&#x4E48;&#x4E00;&#x5927;&#x5806;&#x8BED;&#x53E5;&#xFF0C;&#x4F1A;&#x8BA9;&#x4EE3;&#x7801;&#x663E;&#x5F97;&#x6742;&#x4E71;&#x4E0D;&#x582A;&#xFF0C;&#x5F71;&#x54CD;&#x4EE3;&#x7801;&#x7684;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x8BA9;&#x7EF4;&#x62A4;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x56F0;&#x96BE;&#x3002;</p>
<p>&#x800C;&#x4E14;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x4E5F;&#x662F;I/O&#x64CD;&#x4F5C;&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x8017;&#x65F6;&#x64CD;&#x4F5C;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x80FD;&#x5408;&#x7406;&#x5206;&#x914D;&#x8D44;&#x6E90;&#x7684;&#x8BDD;&#xFF0C;&#x52BF;&#x5FC5;&#x4F1A;&#x5F71;&#x54CD;&#x5230;&#x7A0B;&#x5E8F;&#x7684;&#x6027;&#x80FD;&#x3002;</p>
<p>&#x5F15;&#x5165;&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x7C7B;&#x7684;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x8BA9;&#x7A0B;&#x5E8F;&#x7684;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x66F4;&#x52A0;&#x89C4;&#x8303;&#x5316;&#xFF0C;&#x63D0;&#x9AD8;&#x4EE3;&#x7801;&#x7684;&#x53EF;&#x8BFB;&#x6027;&#xFF0C;&#x548C;&#x7A0B;&#x5E8F;&#x6574;&#x4F53;&#x7684;&#x6267;&#x884C;&#x6548;&#x7387;&#x3002;</p>
<p>&#x56E0;&#x4E3A;&#x6839;&#x636E;&#x672C;&#x7A0B;&#x5E8F;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x6570;&#x636E;&#x5E93;&#x5728;&#x7A0B;&#x5E8F;&#x91CC;&#x66F4;&#x591A;&#x662F;&#x8D77;&#x5230;&#x4E00;&#x79CD;&#x6301;&#x4E45;&#x5316;&#x7684;&#x4F5C;&#x7528;&#xFF1A;&#x5C06;&#x5FC5;&#x8981;&#x4FE1;&#x606F;&#x548C;&#x5DE5;&#x4F5C;&#x73B0;&#x573A;&#x5199;&#x5165;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x7136;&#x540E;&#x53EA;&#x5728;&#x7A0B;&#x5E8F;&#x542F;&#x52A8;&#x65F6;&#x5C06;&#x5FC5;&#x8981;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#xFF0C;&#x540E;&#x7EED;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x8131;&#x79BB;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x76F4;&#x63A5;&#x4ECE;&#x901A;&#x8FC7;&#x8BFB;&#x53D6;&#x5185;&#x5B58;&#x91CC;&#x7684;&#x5BB9;&#x5668;&#x8FDB;&#x884C;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x7C7B;&#x5BF9;&#x65F6;&#x6548;&#x6027;&#x7684;&#x8981;&#x6C42;&#x53EF;&#x4EE5;&#x6CA1;&#x90A3;&#x4E48;&#x9AD8;&#xFF0C;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#x53EF;&#x4EE5;&#x5F02;&#x6B65;&#x8FDB;&#x884C;&#xFF0C;&#x53EF;&#x4EE5;&#x9002;&#x5F53;&#x8FDB;&#x884C;&#x7B49;&#x5F85;&#xFF0C;&#x7B49;&#x961F;&#x5217;&#x91CC;&#x7684;&#x8BED;&#x53E5;&#x79EF;&#x7D2F;&#x5230;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x540E;&#x518D;&#x4E00;&#x6B21;&#x6027;&#x6267;&#x884C;&#x3002;</p>
<p>&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x601D;&#x60F3;&#x8BBE;&#x8BA1;&#x7684;&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x7C7B;&#x6D41;&#x7A0B;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p>
<p>
<!--mermaid-->
<div>
<svg id="mermaid-1546241220124" width="100%" xmlns="http://www.w3.org/2000/svg" style="max-width: 750.45703125px;" viewbox="0 0 750.45703125 795.2484359741211"><style>#mermaid-1546241220124 .label{font-family:trebuchet ms,verdana,arial;color:#333}#mermaid-1546241220124 .node circle,#mermaid-1546241220124 .node ellipse,#mermaid-1546241220124 .node polygon,#mermaid-1546241220124 .node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}#mermaid-1546241220124 .node.clickable{cursor:pointer}#mermaid-1546241220124 .arrowheadPath{fill:green}#mermaid-1546241220124 .edgePath .path{stroke:green;stroke-width:1.5px}#mermaid-1546241220124 .edgeLabel{background-color:#e8e8e8}#mermaid-1546241220124 .cluster rect{fill:#cdffb2!important;stroke:#6eaa49!important;stroke-width:1px!important}#mermaid-1546241220124 .cluster text{fill:#333}#mermaid-1546241220124 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:trebuchet ms,verdana,arial;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1546241220124 .actor{stroke:#13540c;fill:#cde498}#mermaid-1546241220124 text.actor{fill:#000;stroke:none}#mermaid-1546241220124 .actor-line{stroke:grey}#mermaid-1546241220124 .messageLine0{marker-end:"url(#arrowhead)"}#mermaid-1546241220124 .messageLine0,#mermaid-1546241220124 .messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#mermaid-1546241220124 #arrowhead{fill:#333}#mermaid-1546241220124 #crosshead path{fill:#333!important;stroke:#333!important}#mermaid-1546241220124 .messageText{fill:#333;stroke:none}#mermaid-1546241220124 .labelBox{stroke:#326932;fill:#cde498}#mermaid-1546241220124 .labelText,#mermaid-1546241220124 .loopText{fill:#000;stroke:none}#mermaid-1546241220124 .loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}#mermaid-1546241220124 .note{stroke:#6eaa49;fill:#fff5ad}#mermaid-1546241220124 .noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}#mermaid-1546241220124 .section{stroke:none;opacity:.2}#mermaid-1546241220124 .section0,#mermaid-1546241220124 .section2{fill:#6eaa49}#mermaid-1546241220124 .section1,#mermaid-1546241220124 .section3{fill:#fff;opacity:.2}#mermaid-1546241220124 .sectionTitle0,#mermaid-1546241220124 .sectionTitle1,#mermaid-1546241220124 .sectionTitle2,#mermaid-1546241220124 .sectionTitle3{fill:#333}#mermaid-1546241220124 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px}#mermaid-1546241220124 .grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}#mermaid-1546241220124 .grid path{stroke-width:0}#mermaid-1546241220124 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1546241220124 .task{stroke-width:2}#mermaid-1546241220124 .taskText{text-anchor:middle;font-size:11px}#mermaid-1546241220124 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}#mermaid-1546241220124 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1546241220124 .taskText0,#mermaid-1546241220124 .taskText1,#mermaid-1546241220124 .taskText2,#mermaid-1546241220124 .taskText3{fill:#fff}#mermaid-1546241220124 .task0,#mermaid-1546241220124 .task1,#mermaid-1546241220124 .task2,#mermaid-1546241220124 .task3{fill:#487e3a;stroke:#13540c}#mermaid-1546241220124 .taskTextOutside0,#mermaid-1546241220124 .taskTextOutside1,#mermaid-1546241220124 .taskTextOutside2,#mermaid-1546241220124 .taskTextOutside3{fill:#000}#mermaid-1546241220124 .active0,#mermaid-1546241220124 .active1,#mermaid-1546241220124 .active2,#mermaid-1546241220124 .active3{fill:#cde498;stroke:#13540c}#mermaid-1546241220124 .activeText0,#mermaid-1546241220124 .activeText1,#mermaid-1546241220124 .activeText2,#mermaid-1546241220124 .activeText3{fill:#000!important}#mermaid-1546241220124 .done0,#mermaid-1546241220124 .done1,#mermaid-1546241220124 .done2,#mermaid-1546241220124 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1546241220124 .doneText0,#mermaid-1546241220124 .doneText1,#mermaid-1546241220124 .doneText2,#mermaid-1546241220124 .doneText3{fill:#000!important}#mermaid-1546241220124 .crit0,#mermaid-1546241220124 .crit1,#mermaid-1546241220124 .crit2,#mermaid-1546241220124 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1546241220124 .activeCrit0,#mermaid-1546241220124 .activeCrit1,#mermaid-1546241220124 .activeCrit2,#mermaid-1546241220124 .activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}#mermaid-1546241220124 .doneCrit0,#mermaid-1546241220124 .doneCrit1,#mermaid-1546241220124 .doneCrit2,#mermaid-1546241220124 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1546241220124 .activeCritText0,#mermaid-1546241220124 .activeCritText1,#mermaid-1546241220124 .activeCritText2,#mermaid-1546241220124 .activeCritText3,#mermaid-1546241220124 .doneCritText0,#mermaid-1546241220124 .doneCritText1,#mermaid-1546241220124 .doneCritText2,#mermaid-1546241220124 .doneCritText3{fill:#000!important}#mermaid-1546241220124 .titleText{text-anchor:middle;font-size:18px;fill:#000}#mermaid-1546241220124 g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}#mermaid-1546241220124 g.classGroup rect{fill:#cde498;stroke:#13540c}#mermaid-1546241220124 g.classGroup line{stroke:#13540c;stroke-width:1}#mermaid-1546241220124 .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}#mermaid-1546241220124 .classLabel .label{fill:#13540c;font-size:10px}#mermaid-1546241220124 .relation{stroke:#13540c;stroke-width:1;fill:none}#mermaid-1546241220124 #compositionEnd,#mermaid-1546241220124 #compositionStart{fill:#13540c;stroke:#13540c;stroke-width:1}#mermaid-1546241220124 #aggregationEnd,#mermaid-1546241220124 #aggregationStart{fill:#cde498;stroke:#13540c;stroke-width:1}#mermaid-1546241220124 #dependencyEnd,#mermaid-1546241220124 #dependencyStart,#mermaid-1546241220124 #extensionEnd,#mermaid-1546241220124 #extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}#mermaid-1546241220124 .branch-label,#mermaid-1546241220124 .commit-id,#mermaid-1546241220124 .commit-msg{fill:#d3d3d3;color:#d3d3d3}</style><style>#mermaid-1546241220124 {
    color: rgb(0, 0, 0);
    font: normal normal 400 normal 16px / normal "Times New Roman";
  }</style><g transform="translate(-12, -12)"><g class="output"><g class="clusters"><g class="cluster" id="subGraph1" transform="translate(247.728515625,409.62421798706055)" style="opacity: 1;"><rect width="455.45703125" height="779.2484359741211" x="-227.728515625" y="-389.62421798706055"/><g class="label"><g transform="translate(0,0)"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"/></foreignobject></g></g><text x="0" y="-375.62420654296875" fill="black" stroke="none" id="mermaid-1546241220124Text" style="text-anchor: middle;">SQL&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x5FAA;&#x73AF;&#x7EBF;&#x7A0B;</text></g><g class="cluster" id="subGraph0" transform="translate(613.95703125,362.12421798706055)" style="opacity: 1;"><rect width="237" height="278.2484359741211" x="-118.5" y="-139.12421798706055"/><g class="label"><g transform="translate(0,0)"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"/></foreignobject></g></g><text x="0" y="-125.12422180175781" fill="black" stroke="none" id="mermaid-1546241220124Text" style="text-anchor: middle;">&#x63D0;&#x4EA4;SQL&#x4EFB;&#x52A1;&#x7684;&#x7EBF;&#x7A0B;</text></g></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M619.45703125,327.62421798706055L619.45703125,402.7484359741211L619.45703125,437.2484359741211" marker-end="url(#arrowhead123)" style="fill:none"/><defs><marker id="arrowhead123" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M227.6391327247191,84L257.5,109L257.5,134" marker-end="url(#arrowhead124)" style="fill:none"/><defs><marker id="arrowhead124" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M289.4699350421348,173L330.45703125,198L330.45703125,223L330.95703125,248.5000007629394" marker-end="url(#arrowhead125)" style="fill:none"/><defs><marker id="arrowhead125" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M312.12580972371694,349.91721521077756L287.3046875,402.7484359741211L287.3046875,437.2484359741211" marker-end="url(#arrowhead126)" style="fill:none"/><defs><marker id="arrowhead126" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M357.3117730805842,342.39369643235517L404.3046875,402.7484359741211L404.3046875,456.7484359741211L404.3046875,501.2484359741211L404.3046875,535.7484359741211L364.1827325295276,570.2484359741211" marker-end="url(#arrowhead127)" style="fill:none"/><defs><marker id="arrowhead127" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M287.3046875,476.2484359741211L287.3046875,501.2484359741211L287.3046875,535.7484359741211L310.74966166338584,570.2484359741211" marker-end="url(#arrowhead128)" style="fill:none"/><defs><marker id="arrowhead128" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M290.4268270177165,628.2484359741211L242.8046875,662.7484359741211L192.56480094178082,697.2484359741211" marker-end="url(#arrowhead129)" style="fill:none"/><defs><marker id="arrowhead129" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M157.1488388270548,697.2484359741211L175.65234375,662.7484359741211L175.65234375,599.2484359741211L175.65234375,535.7484359741211L175.65234375,501.2484359741211L175.65234375,456.7484359741211L175.65234375,402.7484359741211L175.65234375,308.12421798706055L175.65234375,223L175.65234375,198L221.6341731039326,173" marker-end="url(#arrowhead130)" style="fill:none"/><defs><marker id="arrowhead130" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M113.29452054794521,697.2484359741211L92.5,662.7484359741211L92.5,599.2484359741211L92.5,535.7484359741211L92.5,501.2484359741211L92.5,456.7484359741211L92.5,402.7484359741211L92.5,308.12421798706055L92.5,223L92.5,198L92.5,153.5L92.5,109L155.33576193820224,84" marker-end="url(#arrowhead131)" style="fill:none"/><defs><marker id="arrowhead131" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M638.6223151337515,327.62421798706055L712.45703125,402.7484359741211L712.45703125,456.7484359741211L712.45703125,501.2484359741211L712.45703125,535.7484359741211L712.45703125,599.2484359741211L712.45703125,662.7484359741211L712.45703125,716.2484359741211" marker-end="url(#arrowhead132)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead132" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M607.0923319701603,327.62421798706055L559.45703125,402.7484359741211L361.3046875,442.06548323912375" marker-end="url(#arrowhead133)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead133" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M362.35596087598424,628.2484359741211L400.3046875,662.7484359741211L670.45703125,725.926308857704" marker-end="url(#arrowhead134)" style="stroke: #333; fill:none;stroke-width:2px;stroke-dasharray:3;"/><defs><marker id="arrowhead134" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"/></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="translate(287.3046875,402.7484359741211)" style="opacity: 1;"><g transform="translate(-8,-9.5)" class="label"><foreignobject width="16" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">&#x5426;</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(404.3046875,456.7484359741211)" style="opacity: 1;"><g transform="translate(-8,-9.5)" class="label"><foreignobject width="16" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">&#x662F;</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(287.3046875,535.7484359741211)" style="opacity: 1;"><g transform="translate(-24,-9.5)" class="label"><foreignobject width="48" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">&#x88AB;&#x5524;&#x9192;</span></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"/></div></foreignobject></g></g><g class="edgeLabel" transform="translate(92.5,402.7484359741211)" style="opacity: 1;"><g transform="translate(-40,-9.5)" class="label"><foreignobject width="80" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">&#x8FDE;&#x63A5;&#x88AB;&#x65AD;&#x5F00;</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(712.45703125,535.7484359741211)" style="opacity: 1;"><g transform="translate(-16,-9.5)" class="label"><foreignobject width="32" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">&#x6301;&#x6709;</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(559.45703125,402.7484359741211)" style="opacity: 1;"><g transform="translate(-40,-9.5)" class="label"><foreignobject width="80" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">&#x63D0;&#x4EA4;&#x5E76;&#x901A;&#x77E5;</span></div></foreignobject></g></g><g class="edgeLabel" transform="translate(400.3046875,662.7484359741211)" style="opacity: 1;"><g transform="translate(-16,-9.5)" class="label"><foreignobject width="32" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel">&#x8C03;&#x7528;</span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="connect" transform="translate(204.34765625,64.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-50" y="-19.5" width="100" height="39"/><g class="label" transform="translate(0,0)"><g transform="translate(-40,-9.5)"><foreignobject width="80" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;</div></foreignobject></g></g></g><g class="node" id="read_queue" transform="translate(257.5,153.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-71.3046875" y="-19.5" width="142.609375" height="39"/><g class="label" transform="translate(0,0)"><g transform="translate(-61.3046875,-9.5)"><foreignobject width="122.609375" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">&#x8BFB;&#x53D6;SQL&#x4EFB;&#x52A1;&#x961F;&#x5217;</div></foreignobject></g></g></g><g class="node" id="has_item" transform="translate(330.45703125,308.12421798706055)" style="opacity: 1;"><polygon points="60.124218750000004,0 120.24843750000001,-60.124218750000004 60.124218750000004,-120.24843750000001 0,-60.124218750000004" rx="5" ry="5" transform="translate(-60.124218750000004,60.124218750000004)"/><g class="label" transform="translate(0,0)"><g transform="translate(-37.3046875,-9.5)"><foreignobject width="74.609375" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">&#x6709;SQL&#x4EFB;&#x52A1;</div></foreignobject></g></g></g><g class="node" id="wait_not_empty" transform="translate(287.3046875,456.7484359741211)" style="opacity: 1;"><rect rx="5" ry="5" x="-74" y="-19.5" width="148" height="39"/><g class="label" transform="translate(0,0)"><g transform="translate(-64,-9.5)"><foreignobject width="128" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">&#x7B49;&#x5F85;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x4E8B;&#x4EF6;</div></foreignobject></g></g></g><g class="node" id="take_tasks" transform="translate(330.45703125,599.2484359741211)" style="opacity: 1;"><rect rx="5" ry="5" x="-79.3046875" y="-29" width="158.609375" height="58"/><g class="label" transform="translate(0,0)"><g transform="translate(-69.3046875,-19)"><foreignobject width="138.609375" height="38"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">&#x5C06;&#x961F;&#x5217;&#x91CC;&#x7684;SQL&#x4EFB;&#x52A1;<br/>&#x4E00;&#x6B21;&#x6027;&#x53D6;&#x51FA;&#x5E76;&#x6267;&#x884C;</div></foreignobject></g></g></g><g class="node" id="deal_exception" transform="translate(136.5,735.7484359741211)" style="opacity: 1;"><rect rx="5" ry="5" x="-58" y="-38.5" width="116" height="77"/><g class="label" transform="translate(0,0)"><g transform="translate(-48,-28.5)"><foreignobject width="96" height="57"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">&#x82E5;&#x51FA;&#x73B0;&#x5F02;&#x5E38;<br/>&#x6839;&#x636E;&#x5B9E;&#x9645;&#x60C5;&#x51B5;<br/>&#x4F5C;&#x51FA;&#x76F8;&#x5E94;&#x5904;&#x7406;</div></foreignobject></g></g></g><g class="node" id="create" transform="translate(619.45703125,308.12421798706055)" style="opacity: 1;"><rect rx="5" ry="5" x="-55.3046875" y="-19.5" width="110.609375" height="39"/><g class="label" transform="translate(0,0)"><g transform="translate(-45.3046875,-9.5)"><foreignobject width="90.609375" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">&#x521B;&#x5EFA;SQL&#x4EFB;&#x52A1;</div></foreignobject></g></g></g><g class="node" id="continue" transform="translate(619.45703125,456.7484359741211)" style="opacity: 1;"><rect rx="5" ry="5" x="-58" y="-19.5" width="116" height="39"/><g class="label" transform="translate(0,0)"><g transform="translate(-48,-9.5)"><foreignobject width="96" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">&#x6267;&#x884C;&#x5176;&#x4ED6;&#x4EE3;&#x7801;</div></foreignobject></g></g></g><g class="node" id="callback" transform="translate(712.45703125,735.7484359741211)" style="opacity: 1;"><rect rx="5" ry="5" x="-42" y="-19.5" width="84" height="39"/><g class="label" transform="translate(0,0)"><g transform="translate(-32,-9.5)"><foreignobject width="64" height="19"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">&#x56DE;&#x8C03;&#x65B9;&#x6CD5;</div></foreignobject></g></g></g></g></g></g></svg>
</div>
<!--endmermaid-->

</p>
<p>&#x5982;&#x56FE;&#xFF0C;&#x6574;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x7C7B;&#x5355;&#x72EC;&#x5360;&#x636E;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x7EF4;&#x62A4;&#x4E00;&#x4E2A;SQL&#x4EFB;&#x52A1;&#x961F;&#x5217;&#xFF0C;&#x5728;&#x7A0B;&#x5E8F;&#x5F00;&#x5934;&#x5C31;&#x4FDD;&#x6301;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x4E0D;&#x65AD;&#x5F00;&#xFF0C;&#x4E0D;&#x65AD;&#x68C0;&#x6D4B;SQL&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x662F;&#x5426;&#x6709;SQL&#x4EFB;&#x52A1;&#xFF0C;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#x5C31;&#x8FDB;&#x5165;&#x4F11;&#x7720;&#x72B6;&#x6001;&#x8282;&#x7701;&#x8D44;&#x6E90;&#x6D88;&#x8017;&#xFF0C;&#x6709;&#x4EFB;&#x52A1;&#x518D;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x89E3;&#x91CA;&#x4E00;&#x4E0B;SQL&quot;&#x4EFB;&#x52A1;&quot;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x53EB;SQL&quot;&#x4EFB;&#x52A1;&quot;&#x4E0D;&#x53EB;SQL&quot;&#x8BED;&#x53E5;&#x5462;&quot;&#xFF1F;&#x90A3;&#x662F;&#x56E0;&#x4E3A;&#x5B9E;&#x9645;&#x64CD;&#x4F5C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5E38;&#x5E38;&#x9700;&#x8981;&#x5C06;&#x51E0;&#x6761;SQL&#x8BED;&#x53E5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#x6765;&#x6267;&#x884C;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;&#x5B58;&#x50A8;&#x8FC7;&#x7A0B;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x64CD;&#x4F5C;&#x867D;&#x7136;&#x662F;&#x7531;&#x591A;&#x6761;&#x8BED;&#x53E5;&#x6784;&#x6210;&#xFF0C;&#x4F46;&#x5B83;&#x5FC5;&#x987B;&#x88AB;&#x89C6;&#x4F5C;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#xFF0C;&#x4E00;&#x4E2A;&#x539F;&#x5B50;&#x6765;&#x770B;&#x5F85;&#xFF1A;&#x8981;&#x4E48;&#x6267;&#x884C;&#xFF0C;&#x8981;&#x4E48;&#x4E0D;&#x6267;&#x884C;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x53EA;&#x6267;&#x884C;&#x4E00;&#x534A;&#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x56E0;&#x4E3A;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x6240;&#x4EE5;&#x961F;&#x5217;&#x5B58;&#x653E;&#x7684;&#x4E0D;&#x5E94;&#x8BE5;&#x662F;SQL&quot;&#x8BED;&#x53E5;&quot;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x4E00;&#x7EC4;&#x7279;&#x5B9A;&#x7684;&#x8BED;&#x53E5;&#x7684;&#x5B8C;&#x6574;&#x6027;&#x3002;</p>
<p>&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x5F15;&#x5165;&#x4E86;SQL&#x4EFB;&#x52A1;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x5BF9;SQL&#x4EFB;&#x52A1;&#x79CD;&#x7C7B;&#x7684;&#x5212;&#x5206;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x6570;&#x636E;&#x67E5;&#x8BE2;&#x8BED;&#x8A00;&#x4EFB;&#x52A1;(DQLSqlTask)&#xFF1A;&#x6267;&#x884C;&#x4E00;&#x6761;QUERY&#x8BED;&#x53E5;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x67E5;&#x8BE2;&#x7ED3;&#x679C;&#x3002;</li>
<li>&#x6570;&#x636E;&#x64CD;&#x7EB5;&#x8BED;&#x8A00;&#x4EFB;&#x52A1;(DMLSqlTask)&#xFF1A;&#x6267;&#x884C;&#x4E00;&#x6761;&#x589E;&#x5220;&#x6539;&#x8BED;&#x53E5;&#xFF08;INSERT/UPDATE/DELETE&#xFF09;&#x3002;</li>
<li>&#x590D;&#x5408;SQL&#x4EFB;&#x52A1;(MultiSqlTask)&#xFF1A;&#x7531;&#x590D;&#x6570;SQL&#x4EFB;&#x52A1;&#x7EC4;&#x6210;&#x3002;&#x6784;&#x6210;&#x5B83;&#x7684;SQL&#x4EFB;&#x52A1;&#x53EF;&#x4EE5;&#x662F;&#x67E5;&#x8BE2;&#x4EFB;&#x52A1;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x64CD;&#x7EB5;&#x4EFB;&#x52A1;&#xFF0C;&#x5B83;&#x4E0D;&#x5173;&#x5FC3;&#x5185;&#x90E8;&#x7684;&#x5177;&#x4F53;&#x6784;&#x6210;&#xFF0C;&#x53EA;&#x786E;&#x4FDD;&#x6574;&#x4E2A;SQL&#x4EFB;&#x52A1;&#x7684;&#x539F;&#x5B50;&#x6027;&#x3002;</li>
</ol>
<p>&#x50CF;&#x8FD9;&#x6837;&#xFF0C;&#x5C06;&#x4E00;&#x6761;&#x6761;SQL&#x5F53;&#x505A;&#x4EFB;&#x52A1;&#x5904;&#x7406;&#xFF0C;&#x5E76;&#x7528;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x7C7B;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x6709;&#x4EE5;&#x4E0B;&#x597D;&#x5904;&#xFF1A;</p>
<ul>
<li>&#x7B80;&#x5316;&#x6267;&#x884C;SQL&#x8BED;&#x53E5;&#x7684;&#x6B65;&#x9AA4;&#xFF0C;&#x903B;&#x8F91;&#x66F4;&#x52A0;&#x6E05;&#x6670;&#xFF0C;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x4EE3;&#x7801;&#x7684;&#x53EF;&#x8BFB;&#x6027;&#x3002;</li>
<li>&#x907F;&#x514D;&#x9891;&#x7E41;&#x7684;&#x8FDE;&#x63A5;/&#x65AD;&#x5F00;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x907F;&#x514D;&#x65E0;&#x8C13;&#x7684;&#x8D44;&#x6E90;&#x6D6A;&#x8D39;&#x3002;</li>
<li>&#x56E0;&#x4E3A;&#x6BCF;&#x6B21;&#x662F;&#x4ECE;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x4EFB;&#x52A1;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4F18;&#x5148;&#x7EA7;&#x961F;&#x5217;&#xFF0C;&#x8BA9;&#x4F18;&#x5148;&#x7EA7;&#x9AD8;&#x7684;SQL&#x4EFB;&#x52A1;&#x5148;&#x6267;&#x884C;&#xFF0C;&#x8BA9;&#x4EE3;&#x7801;&#x66F4;&#x52A0;&#x7075;&#x6D3B;&#x3002;</li>
<li>SQL&#x64CD;&#x4F5C;&#x5F02;&#x6B65;&#x5316;&#xFF0C;&#x53D1;&#x8D77;SQL&#x64CD;&#x4F5C;&#x7684;&#x7EBF;&#x7A0B;&#x65E0;&#x9700;&#x7B49;&#x5F85;SQL&#x8BED;&#x53E5;&#x6267;&#x884C;&#x5B8C;&#x6210;&#x5C31;&#x80FD;&#x7EE7;&#x7EED;&#x540E;&#x7EED;&#x64CD;&#x4F5C;&#x3002;</li>
</ul>
<p>&#x5173;&#x4E8E;SQL&#x4EFB;&#x52A1;&#x7C7B;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x4E0B;&#x4E00;&#x5C0F;&#x8282;&#x4F1A;&#x8BB2;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x5148;&#x8BB2;&#x4E00;&#x4E0B;&#x4E3B;&#x5FAA;&#x73AF;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<p>&#x5728;&#x5F00;&#x59CB;&#x5FAA;&#x73AF;&#x524D;&#x5148;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x672C;&#x9879;&#x76EE;&#x4F7F;&#x7528;&#x7684;&#x662F;mysql5.6&#x3002;</p>
<pre><code class="lang-C++">using sql::PreparedStatement;
using sql::Connection;

Logger&amp; log(G::LogOfDatabase());
std::unique_ptr&lt;sql::Connection&gt; connection(nullptr);
SqlTask *current_sqltask = nullptr;
std::unique_ptr&lt;sql::Savepoint&gt; save_point(nullptr);

...

try
{
    //&#x8F93;&#x5165;&#x6570;&#x636E;&#x5E93;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x7528;&#x6237;&#x540D;&#xFF0C;&#x5BC6;&#x7801;&#xFF0C;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;
     connection.reset(_driver()-&gt;connect(Conf.DBHost, Conf.DBUsername, Conf.DBPassword));
     assert(connection != nullptr);
     connection-&gt;setSchema(Conf.DBSchema);
     connection-&gt;setAutoCommit(false);//&#x53D6;&#x6D88;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#xFF0C;&#x907F;&#x514D;&#x63D2;&#x5165;&#x5927;&#x91CF;&#x6570;&#x636E;&#x65F6;&#x7F13;&#x6162;
}                
catch (const sql::SQLException &amp;e) {
    log.fatal(fmt(&quot;&#x9996;&#x6B21;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#x65F6;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#xFF0C;&#x7A0B;&#x5E8F;&#x9000;&#x51FA;&#xFF0C;%1%&quot;)%errmsg(e));
    Global::IsGoingWell() = false;
    exit(1);//&#x7A0B;&#x5E8F;&#x5F02;&#x5E38;&#x9000;&#x51FA;
}
</code></pre>
<p>&#x6CE8;&#x610F;&#x8FD9;&#x4E00;&#x53E5;<code>connection-&gt;setAutoCommit(false);</code>&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x5B83;&#x4F1A;&#x5173;&#x95ED;mysql&#x7684;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#x7279;&#x6027;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x5173;&#x95ED;&#x5B83;&#x7684;&#x8BDD;&#xFF0C;&#x6BCF;&#x6267;&#x884C;&#x4E00;&#x6B21;sql&#x90FD;&#x4F1A;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#xFF0C;&#x5F53;&#x961F;&#x5217;&#x91CC;&#x6709;&#x5927;&#x91CF;&#x6570;&#x636E;&#x65F6;&#x4F1A;&#x62D6;&#x6162;&#x6267;&#x884C;&#x901F;&#x5EA6;&#x3002;</p>
<p>&#x5173;&#x95ED;&#x4E86;&#x4EE5;&#x540E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E00;&#x6B21;&#x6027;&#x6279;&#x91CF;&#x6267;&#x884C;&#x591A;&#x6761;sql&#x8BED;&#x53E5;&#x540E;&#x518D;&#x624B;&#x52A8;&#x63D0;&#x4EA4;&#xFF0C;&#x4ECE;&#x800C;&#x63D0;&#x9AD8;&#x8FD0;&#x884C;&#x6548;&#x7387;&#x3002;</p>
<p>&#x7136;&#x540E;&#x5F00;&#x59CB;&#x5FAA;&#x73AF;&#xFF0C;&#x5148;&#x53D6;&#x4EFB;&#x52A1;&#xFF1A;</p>
<pre><code class="lang-C++"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">deque</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;SqlTask&gt; &gt; task_queue;<span class="hljs-comment">//&#x4E34;&#x65F6;&#x4EFB;&#x52A1;&#x961F;&#x5217;</span>
<span class="hljs-keyword">int</span> task_index = <span class="hljs-number">0</span>;<span class="hljs-comment">//&#x5904;&#x7406;&#x5230;&#x7B2C;&#x51E0;&#x4E2A;&#x4EFB;&#x52A1;</span>
<span class="hljs-keyword">while</span> (Global::IsGoingWell())<span class="hljs-comment">//&#x5F53;&#x7A0B;&#x5E8F;&#x6B63;&#x5E38;&#x8FD0;&#x4F5C;&#x65F6;</span>
{
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-keyword">if</span> (task_queue.empty())
        {        
            <span class="hljs-comment">//DLOG(&quot;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x7B49;&#x5F85;&#x975E;&#x7A7A;&#x4E8B;&#x4EF6;&#xFF0C;&#x4E0A;&#x9501;&quot;);</span>
            {
                <span class="hljs-built_in">std</span>::unique_lock&lt;<span class="hljs-built_in">std</span>::mutex&gt; lock(_mutex());
                <span class="hljs-keyword">if</span> (_isEmpty())
                {
                    _notEmpty().wait(lock);<span class="hljs-comment">//&#x65E0;&#x4EFB;&#x52A1;&#x7B49;&#x5F85;&#x975E;&#x7A7A;&#x4E8B;&#x4EF6;</span>
                }
                assert(!_isEmpty());
            }
            <span class="hljs-comment">//DLOG(&quot;&#x63A5;&#x6536;&#x5230;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x4E8B;&#x4EF6;&#xFF0C;&#x89E3;&#x9501;&quot;);</span>
            <span class="hljs-comment">//&#x6709;&#x4EFB;&#x52A1;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x4EFB;&#x52A1;&#x7684;&#x63D2;&#x5165;&#x4E00;&#x822C;&#x5177;&#x6709;&#x8FDE;&#x7EED;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x77ED;&#x6682;&#x7B49;&#x5F85;&#xFF0C;&#x8BA9;&#x961F;&#x5217;&#x91CC;&#x7684;&#x4EFB;&#x52A1;&#x66F4;&#x591A;&#x4E00;&#x70B9;&#x518D;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x6B65;</span>
            ThreadHelper::SleerForMilliseconds(<span class="hljs-number">200</span>);
            _takeAll(task_queue);
        }
</code></pre>
<p>&#x5176;&#x4E2D;<code>task_queue</code>&#x4E3A;&#x4E34;&#x65F6;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#xFF0C;&#x6BCF;&#x6B21;&#x5B83;&#x4F1A;&#x53D6;&#x8D70;&#x4E3B;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x4E2D;&#x76EE;&#x524D;&#x62E5;&#x6709;&#x7684;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x3002;&#x5F15;&#x5165;&#x4E34;&#x65F6;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x7684;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x540C;&#x6B65;&#x95EE;&#x9898;&#x3002;&#x56E0;&#x4E3A;&#x63D0;&#x4EA4;&#x7684;SQL&#x4EFB;&#x52A1;&#x6765;&#x81EA;&#x4E8E;&#x5176;&#x5B83;&#x7EBF;&#x7A0B;&#xFF0C;&#x56E0;&#x6B64;&#x63D0;&#x4EA4;SQL&#x4EFB;&#x52A1;&#x7684;&#x64CD;&#x4F5C;&#x548C;&#x53D6;SQL&#x4EFB;&#x52A1;&#x7684;&#x64CD;&#x4F5C;&#x5FC5;&#x987B;&#x4E92;&#x65A5;&#xFF0C;&#x56E0;&#x6B64;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x4E3B;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x6BCF;&#x6B21;&#x53D6;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#x7684;&#x8BDD;&#xFF0C;&#x961F;&#x5217;&#x91CC;&#x6709;&#x591A;&#x5C11;&#x4E2A;SQL&#x4EFB;&#x52A1;&#x5C31;&#x8981;&#x52A0;&#x591A;&#x5C11;&#x6B21;&#x4E92;&#x65A5;&#x9501;&#xFF0C;&#x8FD9;&#x6837;&#x6548;&#x7387;&#x592A;&#x6162;&#x3002;&#x800C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E34;&#x65F6;&#x961F;&#x5217;&#x7684;&#x8BDD;&#xFF0C;&#x4E00;&#x6B21;&#x6027;&#x5C06;&#x4E3B;&#x961F;&#x5217;&#x76EE;&#x524D;&#x62E5;&#x6709;&#x7684;&#x4EFB;&#x52A1;&#x5168;&#x90E8;&#x53D6;&#x51FA;&#xFF0C;&#x90A3;&#x5C31;&#x53EA;&#x9700;&#x8981;&#x52A0;&#x4E00;&#x6B21;&#x4E92;&#x65A5;&#x9501;&#x5C31;&#x591F;&#x4E86;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x5F15;&#x5165;&#x4E34;&#x65F6;&#x961F;&#x5217;&#x7684;&#x539F;&#x56E0;&#x3002;</p>
<p><code>_isEmpty()</code>&#x7528;&#x6765;&#x5224;&#x65AD;&#x4E3B;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x662F;&#x5426;&#x4E3A;&#x7A7A;&#xFF0C;&#x5982;&#x679C;&#x4E3A;&#x7A7A;&#x7684;&#x8BDD;&#x7528;&#x6761;&#x4EF6;&#x53D8;&#x91CF;&#x963B;&#x585E;&#x961F;&#x5217;&#xFF0C;&#x76F4;&#x5230;&#x6536;&#x5230;&#x4FE1;&#x53F7;&#x88AB;&#x5524;&#x9192;&#x3002;</p>
<p><code>_takeAll(queue)</code>&#x5C31;&#x662F;&#x5C06;&#x4E3B;&#x961F;&#x5217;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x8F6C;&#x4EA4;&#x7ED9;&#x4E34;&#x65F6;&#x961F;&#x5217;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<p><code>_isEmpty()</code>&#x3001;<code>_takeAll(queue)</code>&#x7684;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-C++"><span class="hljs-comment">//&#x5224;&#x65AD;&#x961F;&#x5217;&#x662F;&#x5426;&#x975E;&#x7A7A;&#xFF08;&#x975E;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF09;</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> _isEmpty()
{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; (<span class="hljs-keyword">int</span>)SqlTaskPriority::Size; i++)
    {
        <span class="hljs-keyword">auto</span> &amp;<span class="hljs-built_in">queue</span> = _queue_sqlTask((SqlTaskPriority)i);
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">queue</span>.empty())<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">//&#x628A;&#x961F;&#x5217;&#x91CC;&#x7684;&#x4EFB;&#x52A1;&#x5168;&#x90E8;&#x8F6C;&#x4EA4;&#x51FA;&#x53BB;&#xFF08;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF09;</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> _takeAll(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">deque</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;SqlTask&gt; &gt;&amp; output_queue)
{            
    <span class="hljs-comment">//DLOG(&quot;&#x4E0A;&#x9501;&quot;);</span>
    <span class="hljs-built_in">std</span>::lock_guard&lt;<span class="hljs-built_in">std</span>::mutex&gt; lock(_mutex());

    <span class="hljs-comment">//&#x6309;&#x4EFB;&#x52A1;&#x4F18;&#x5148;&#x7EA7;&#x4ECE;&#x9AD8;&#x5230;&#x5E95;&#x8F6C;&#x4EA4;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x4EFB;&#x52A1;</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; (<span class="hljs-keyword">int</span>)SqlTaskPriority::Size; i++)
    {
        <span class="hljs-keyword">auto</span> &amp;<span class="hljs-built_in">queue</span> = _queue_sqlTask((SqlTaskPriority)i);
        <span class="hljs-keyword">while</span>(!<span class="hljs-built_in">queue</span>.empty())
        {
            output_queue.emplace_back(<span class="hljs-built_in">std</span>::move(<span class="hljs-built_in">queue</span>.front()));
            <span class="hljs-built_in">queue</span>.pop();
        }
    }
    <span class="hljs-comment">//DLOG(&quot;&#x89E3;&#x9501;&quot;);</span>
}
</code></pre>
<p>&#x5C06;&#x4E3B;&#x961F;&#x5217;&#x91CC;&#x76EE;&#x524D;&#x62E5;&#x6709;&#x7684;&#x4EFB;&#x52A1;&#x5168;&#x90E8;&#x8F6C;&#x79FB;&#x5230;&#x4E34;&#x65F6;&#x961F;&#x5217;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x4E86;&#xFF0C;&#x4F46;&#x5728;&#x5F00;&#x59CB;&#x524D;&#x4F1A;&#x5148;&#x68C0;&#x67E5;&#x4E0B;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x662F;&#x5426;&#x65AD;&#x5F00;&#xFF0C;&#x82E5;&#x65AD;&#x5F00;&#x5219;&#x8FDB;&#x884C;&#x91CD;&#x8FDE;&#x3002;&#x68C0;&#x67E5;&#x4E0A;&#x8F6E;&#x5FAA;&#x73AF;&#x6709;&#x6CA1;&#x6709;&#x9057;&#x7559;&#x7684;&#x4FDD;&#x5B58;&#x70B9;&#xFF08;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#x8BF4;&#x660E;&#x4E0A;&#x4E00;&#x8F6E;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x65F6;&#x53D1;&#x751F;&#x4E86;&#x5F02;&#x5E38;&#xFF0C;&#x9700;&#x8981;&#x56DE;&#x6EDA;&#xFF09;&#xFF0C;&#x786E;&#x5B9A;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x540E;&#x518D;&#x8FDB;&#x884C;&#x4E0B;&#x4E00;&#x6B65;&#xFF1A;</p>
<pre><code class="lang-C++">            <span class="hljs-comment">//...</span>
            _takeAll(task_queue);
        }

        current_sqltask = <span class="hljs-literal">nullptr</span>;

        <span class="hljs-keyword">if</span> (connection==<span class="hljs-literal">nullptr</span>||!connection-&gt;isValid())
        {
            <span class="hljs-comment">//&#x5982;&#x679C;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x65AD;&#x5F00;&#xFF0C;&#x8FDB;&#x884C;&#x91CD;&#x8FDE;</span>
            reconnect();
        }
</code></pre>
<p>&#x786E;&#x8BA4;&#x6CA1;&#x6709;&#x95EE;&#x9898;&#x540E;&#xFF0C;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x4EFB;&#x52A1;</p>
<pre><code class="lang-C++">        <span class="hljs-comment">//&#x4E0A;&#x6B21;&#x5904;&#x7406;&#x4E86;&#x591A;&#x5C11;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x503C;&#x4E0D;&#x4E3A;0&#xFF0C;&#x5219;&#x610F;&#x5473;&#x7740;&#x4E0A;&#x6B21;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x7684;&#x4E2D;&#x9014;&#x53D1;&#x751F;&#x4E86;sql&#x9519;&#x8BEF;</span>
        <span class="hljs-keyword">int</span> last_executed_sql_task_count = task_index;
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;SqlTask&gt; &amp;p_task : task_queue)
        {
            <span class="hljs-keyword">if</span> (last_executed_sql_task_count-- &gt; <span class="hljs-number">0</span>)<span class="hljs-keyword">continue</span>;<span class="hljs-comment">//&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x8FC7;&#x7684;sql&#x8DF3;&#x8FC7;</span>
            current_sqltask = p_task.get();
            <span class="hljs-keyword">if</span> (p_task-&gt;get_type() == SqlTaskType::Multi)
            {
                <span class="hljs-comment">//&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x6027;&#x5EFA;&#x7ACB;&#x4FDD;&#x5B58;&#x70B9;</span>
                save_point.reset(connection-&gt;setSavepoint(<span class="hljs-string">&quot;multi_task&quot;</span>));
                p_task-&gt;exec_sql(connection.get());
                connection-&gt;releaseSavepoint(save_point.get());
                save_point.reset(<span class="hljs-literal">nullptr</span>);
            }
            <span class="hljs-keyword">else</span>
            {
                p_task-&gt;exec_sql(connection.get());
            }
            task_index++;
        }
        connection-&gt;commit();<span class="hljs-comment">//&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;</span>
        current_sqltask = <span class="hljs-literal">nullptr</span>;
</code></pre>
<p><code>last_executed_sql_task_count</code>&#x4EE3;&#x8868;&#x4E0A;&#x4E00;&#x8F6E;&#x5FAA;&#x73AF;&#x6267;&#x884C;&#x4E86;&#x591A;&#x5C11;&#x4E2A;&#x4EFB;&#x52A1;&#x3002;&#x56E0;&#x4E3A;&#x4EFB;&#x52A1;&#x5728;&#x6267;&#x884C;&#x5230;&#x4E00;&#x534A;&#x6709;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x7684;&#x8BDD;&#xFF0C;&#x7A0B;&#x5E8F;&#x4E0D;&#x4F1A;&#x6E05;&#x7406;&#x4E34;&#x65F6;&#x961F;&#x5217;&#xFF0C;&#x800C;&#x4F1A;&#x5C1D;&#x8BD5;&#x518D;&#x6B21;&#x6267;&#x884C;&#x3002;&#x4F46;&#x5728;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x7684;&#x4EFB;&#x52A1;&#x524D;&#x6267;&#x884C;&#x7684;&#x4EFB;&#x52A1;&#x662F;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x6210;&#x529F;&#x4E86;&#xFF0C;&#x4ED6;&#x4EEC;&#x4E0D;&#x80FD;&#x88AB;&#x91CD;&#x590D;&#x6267;&#x884C;&#xFF0C;&#x56E0;&#x6B64;&#x4F1A;&#x8DF3;&#x8FC7;&#x90A3;&#x4E9B;&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x6210;&#x529F;&#x7684;&#x4EFB;&#x52A1;&#x3002;</p>
<p>&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x65F6;&#xFF0C;&#x4F1A;&#x5224;&#x65AD;&#x4EFB;&#x52A1;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x662F;Multi&#x590D;&#x5408;&#x4EFB;&#x52A1;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x6574;&#x4E2A;&#x590D;&#x5408;&#x4EFB;&#x52A1;&#x7684;&#x539F;&#x5B50;&#x6027;&#xFF0C;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x4FDD;&#x5B58;&#x70B9;&#xFF0C;&#x4E07;&#x4E00;&#x9047;&#x5230;&#x5F02;&#x5E38;&#x53EF;&#x4EE5;&#x56DE;&#x6EDA;&#xFF0C;&#x4ECE;&#x800C;&#x4FDD;&#x8BC1;&#x590D;&#x5408;&#x4EFB;&#x52A1;&#x7684;&#x539F;&#x5B50;&#x6027;&#x3002;</p>
<p>&#x6267;&#x884C;&#x5B8C;&#x4EFB;&#x52A1;&#x540E;&#xFF0C;&#x5F00;&#x59CB;&#x9010;&#x4E00;&#x8C03;&#x7528;&#x4EFB;&#x52A1;&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#xFF1A;</p>
<pre><code class="lang-C++">        <span class="hljs-comment">//&#x5F00;&#x59CB;&#x5904;&#x7406;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;</span>
        <span class="hljs-keyword">do</span>
        {
            task_queue.front()-&gt;exec_callback();
            task_queue.pop_front();
        } <span class="hljs-keyword">while</span> (!task_queue.empty());
        task_index = <span class="hljs-number">0</span>;
</code></pre>
<p>&#x6CE8;&#x610F;&#xFF0C;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x4E3A;&#x4E86;&#x7075;&#x6D3B;&#xFF0C;&#x662F;&#x5728;&#x4E3B;&#x5FAA;&#x73AF;&#x4E2D;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x6765;&#x5904;&#x7406;&#xFF08;&#x56E0;&#x4E3A;&#x8FC7;&#x4E8E;&#x7B80;&#x5355;&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x4EA4;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x5904;&#x7406;&#x53CD;&#x800C;&#x662F;&#x4E00;&#x79CD;&#x8D44;&#x6E90;&#x6D6A;&#x8D39;&#xFF09;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x91CC;&#x9762;&#x4E0D;&#x80FD;&#x6267;&#x884C;&#x8FC7;&#x4E8E;&#x8017;&#x65F6;&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x53EF;&#x4EE5;&#x5728;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x5185;&#x90E8;&#x5C06;&#x8017;&#x65F6;&#x4F5C;&#x4E1A;&#x8F6C;&#x4EA4;&#x7ED9;&#x7EBF;&#x7A0B;&#x6C60;&#x3002;</p>
<p>&#x7A0B;&#x5E8F;&#x7684;&#x6B63;&#x5E38;&#x903B;&#x8F91;&#x5C31;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x7684;&#x8BDD;&#xFF0C;&#x5FAA;&#x73AF;&#x5230;&#x6B64;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#xFF0C;&#x5F00;&#x59CB;&#x4E0B;&#x4E00;&#x8F6E;&#x53D6;&#x4EFB;&#x52A1;&#x2192;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x5FAA;&#x73AF;&#x3002;</p>
<p>&#x5982;&#x679C;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x5F02;&#x5E38;&#x5904;&#x7406;&#xFF1A;</p>
<pre><code class="lang-C++">    <span class="hljs-comment">//...</span>
    }
    <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">const</span> sql::SQLException &amp;e)
    {
        <span class="hljs-keyword">if</span> (connection == <span class="hljs-literal">nullptr</span>)
        {
            <span class="hljs-built_in">log</span>.error(<span class="hljs-string">&quot;&#x6570;&#x636E;&#x5E93;&#x610F;&#x5916;&#x65AD;&#x5F00;&#xFF0C;&#x4E14;&#x91CD;&#x8FDE;&#x5931;&#x8D25;&#xFF0C;&#x4F11;&#x606F;5&#x79D2;&#x540E;&#x91CD;&#x8BD5;&quot;</span>);
            ThreadHelper::Sleep(<span class="hljs-number">5</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (connection-&gt;isValid())
        {
            <span class="hljs-comment">//&#x9047;&#x5230;&#x5F02;&#x5E38;&#xFF0C;&#x5148;&#x68C0;&#x67E5;&#x6570;&#x636E;&#x5E93;&#x94FE;&#x63A5;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x6548;</span>
            <span class="hljs-keyword">int</span> error_code = e.getErrorCode();
            <span class="hljs-keyword">switch</span> (error_code)
            {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1062</span>:
                <span class="hljs-built_in">log</span>.errorAndNotifyAdmin(
                    fmt(<span class="hljs-string">&quot;&#x53D1;&#x751F;&#x4E3B;&#x952E;&#x91CD;&#x590D;&#x9519;&#x8BEF;&#xFF0C;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x6709;&#x4EBA;&#x4EBA;&#x4E3A;&#x4FEE;&#x6539;&#x4E86;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x8BE5;&#x64CD;&#x4F5C;&#x8DF3;&#x8FC7;&#xFF0C;&#x8BE6;&#x60C5;&#xFF1A;\n\t%1%&quot;</span>) % errmsg(e));
                task_index++;<span class="hljs-comment">//&#x4E0B;&#x4E00;&#x8F6E;&#x8DF3;&#x8FC7;&#x8BE5;&#x4EFB;&#x52A1;</span>
                <span class="hljs-keyword">if</span> (save_point != <span class="hljs-literal">nullptr</span>)<span class="hljs-comment">//&#x5982;&#x679C;&#x6709;&#x4FDD;&#x5B58;&#x70B9;</span>
                {
                    connection-&gt;rollback(save_point.get());
                    connection-&gt;releaseSavepoint(save_point.get());
                    save_point = <span class="hljs-literal">nullptr</span>;
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-built_in">log</span>.errorAndNotifyAdmin(fmt(<span class="hljs-string">&quot;&#x53D1;&#x751F;&#x4E86;&#x672A;&#x77E5;&#x9519;&#x8BEF;[%1%]&#x4F11;&#x606F;&#x4E00;&#x5206;&#x949F;&#x540E;&#x518D;&#x7EE7;&#x7EED;&#xFF0C;&#x8BE6;&#x60C5;&#xFF1A;\n\t%2%&quot;</span>)%error_code % errmsg(e));                            
                DMLSqlTask::ClearPreparedStatementCache();<span class="hljs-comment">//&#x6E05;&#x9664;&#x9759;&#x6001;SqlTask&#x7F13;&#x5B58;</span>
                ThreadHelper::Sleep(<span class="hljs-number">60</span>);<span class="hljs-comment">//&#x4F11;&#x606F;&#x4E00;&#x5206;&#x949F;&#x540E;&#x518D;&#x7EE7;&#x7EED;&#xFF0C;&#x4E0D;&#x8DF3;&#x8FC7;</span>
                <span class="hljs-keyword">break</span>;
            }

        }            
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-built_in">log</span>.error(fmt(<span class="hljs-string">&quot;&#x6267;&#x884C;&#x4E8B;&#x52A1;&#x7684;&#x671F;&#x95F4;&#x94FE;&#x63A5;&#x65AD;&#x5F00;&#xFF0C;&#x81EA;&#x7136;&#x56DE;&#x6EDA;&#xFF0C;&#x91CD;&#x505A;&#x4E4B;&#x524D;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x8BE6;&#x60C5;&#xFF1A;\n\t%1%&quot;</span>)%errmsg(e));
            task_index = <span class="hljs-number">0</span>;<span class="hljs-comment">//&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x7D22;&#x5F15;</span>
            <span class="hljs-keyword">if</span> (save_point != <span class="hljs-literal">nullptr</span>)
            {
                save_point.reset(<span class="hljs-literal">nullptr</span>);<span class="hljs-comment">//&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x540E;&#xFF0C;&#x4FDD;&#x5B58;&#x70B9;&#x81EA;&#x52A8;&#x5931;&#x6548;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x91CA;&#x653E;&#x64CD;&#x4F5C;</span>
            }
        }
    }
}
</code></pre>
<p>&#x5230;&#x6B64;&#x6574;&#x4E2A;&#x4E3B;&#x5FAA;&#x73AF;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x8BB2;&#x89E3;&#x5B8C;&#x4E86;&#xFF0C;&#x4EE5;&#x4E0B;&#x4E3A;&#x6574;&#x4E2A;&#x4E3B;&#x5FAA;&#x73AF;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code class="lang-C++">static void Run()
{
    ThreadHelper::CreateThread([](){
        using sql::PreparedStatement;
        using sql::Connection;

        Logger&amp; log(G::LogOfDatabase());
        std::unique_ptr&lt;sql::Connection&gt; connection(nullptr);
        SqlTask *current_sqltask = nullptr;
        std::unique_ptr&lt;sql::Savepoint&gt; save_point(nullptr);

        auto reconnect = [&amp;connection]()
        {
            //&#x4E0D;&#x80FD;&#x7528;connection-&gt;reconnect() &#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x91CD;&#x8FDE;&#x540E;&#x4F1A;&#x51FA;&#x73B0;&#x83AB;&#x540D;&#x5176;&#x5999;&#x7684;bug
            //&#x6BD4;&#x5982;&#x8BF4;&#x8BBE;&#x7F6E;&#x4EFB;&#x4F55;&#x540D;&#x5B57;&#x7684;savepoint&#xFF0C;&#x91CA;&#x653E;&#x65F6;&#x90FD;&#x4F1A;&#x63D0;&#x793A;savepoint&#x4E0D;&#x5B58;&#x5728;&#x7684;bug&#xFF0C;&#x6545;&#x4E0D;&#x91C7;&#x7528;
            DMLSqlTask::ClearPreparedStatementCache();//&#x6E05;&#x9664;&#x9759;&#x6001;SqlTask&#x7F13;&#x5B58;
            connection.reset(nullptr);//&#x5148;&#x6E05;&#x7A7A;&#x4E0A;&#x6B21;&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x8FD9;&#x6837;&#x5982;&#x679C;&#x8FDE;&#x63A5;&#x65F6;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x7684;&#x8BDD;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;connection==nullptr&#x6765;&#x5224;&#x65AD;
            connection.reset(_driver()-&gt;connect(Conf.DBHost, Conf.DBUsername, Conf.DBPassword));
            connection-&gt;setSchema(Conf.DBSchema);
            connection-&gt;setAutoCommit(false);//&#x53D6;&#x6D88;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#xFF0C;&#x907F;&#x514D;&#x63D2;&#x5165;&#x5927;&#x91CF;&#x6570;&#x636E;&#x65F6;&#x7F13;&#x6162;
        };

        auto errmsg = [&amp;current_sqltask](const sql::SQLException &amp;e)
        {
            if (current_sqltask == nullptr)
            {
                return str(fmt(&quot;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF1A;%1%&#xFF0C;&#x9519;&#x8BEF;&#x7801;&#xFF1A;%2%&#xFF0C;SQLState&#xFF1A;%3%&quot;)
                    % e.what() % e.getErrorCode() % e.getSQLState());
            }                    
            else
            {
                return str(fmt(&quot;&#x6267;&#x884C;&#x8BED;&#x53E5;[%4%]&#x65F6;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#xFF0C;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF1A;%1%&#xFF0C;&#x9519;&#x8BEF;&#x7801;&#xFF1A;%2%&#xFF0C;SQLState&#xFF1A;%3%&quot;)
                    % e.what() % e.getErrorCode() % e.getSQLState() % current_sqltask-&gt;to_string());
            }
        };

        try
        {
             connection.reset(_driver()-&gt;connect(Conf.DBHost, Conf.DBUsername, Conf.DBPassword));
             assert(connection != nullptr);
             connection-&gt;setSchema(Conf.DBSchema);
             connection-&gt;setAutoCommit(false);//&#x53D6;&#x6D88;&#x81EA;&#x52A8;&#x63D0;&#x4EA4;&#xFF0C;&#x907F;&#x514D;&#x63D2;&#x5165;&#x5927;&#x91CF;&#x6570;&#x636E;&#x65F6;&#x7F13;&#x6162;
        }                
        catch (const sql::SQLException &amp;e) {
            log.fatal(fmt(&quot;&#x9996;&#x6B21;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#x65F6;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#xFF0C;&#x7A0B;&#x5E8F;&#x9000;&#x51FA;&#xFF0C;%1%&quot;)%errmsg(e));
            Global::IsGoingWell() = false;
            exit(1);//&#x7A0B;&#x5E8F;&#x5F02;&#x5E38;&#x9000;&#x51FA;
        }


        std::deque&lt;std::unique_ptr&lt;SqlTask&gt; &gt; task_queue;//&#x4EFB;&#x52A1;&#x961F;&#x5217;
        int task_index = 0;//&#x5904;&#x7406;&#x5230;&#x7B2C;&#x51E0;&#x4E2A;&#x4EFB;&#x52A1;
        while (Global::IsGoingWell())//&#x5F53;&#x7A0B;&#x5E8F;&#x6B63;&#x5E38;&#x8FD0;&#x4F5C;&#x65F6;
        {
            try
            {
                if (task_queue.empty())
                {        
                    //DLOG(&quot;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x7B49;&#x5F85;&#x975E;&#x7A7A;&#x4E8B;&#x4EF6;&#xFF0C;&#x4E0A;&#x9501;&quot;);
                    {
                        std::unique_lock&lt;std::mutex&gt; lock(_mutex());
                        if (_isEmpty())
                        {
                            _notEmpty().wait(lock);//&#x65E0;&#x4EFB;&#x52A1;&#x7B49;&#x5F85;&#x975E;&#x7A7A;&#x4E8B;&#x4EF6;
                        }
                        assert(!_isEmpty());
                    }
                    //DLOG(&quot;&#x63A5;&#x6536;&#x5230;&#x961F;&#x5217;&#x975E;&#x7A7A;&#x4E8B;&#x4EF6;&#xFF0C;&#x89E3;&#x9501;&quot;);
                    //&#x6709;&#x4EFB;&#x52A1;&#xFF0C;&#x56E0;&#x4E3A;&#x6570;&#x636E;&#x5E93;&#x4EFB;&#x52A1;&#x7684;&#x63D2;&#x5165;&#x4E00;&#x822C;&#x5177;&#x6709;&#x8FDE;&#x7EED;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x7B49;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x518D;&#x7EE7;&#x7EED;
                    ThreadHelper::SleerForMilliseconds(200);
                    _takeAll(task_queue);
                }

                current_sqltask = nullptr;

                if (connection==nullptr||!connection-&gt;isValid())
                {
                    reconnect();
                }

                if (save_point != nullptr)//&#x5982;&#x679C;&#x4E0A;&#x6B21;&#x6709;&#x4FDD;&#x5B58;&#x70B9;
                {
                    connection-&gt;rollback(save_point.get());
                    connection-&gt;releaseSavepoint(save_point.get());
                    save_point.reset(nullptr);
                }

                //&#x4E0A;&#x6B21;&#x5904;&#x7406;&#x4E86;&#x591A;&#x5C11;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x503C;&#x4E0D;&#x4E3A;0&#xFF0C;&#x5219;&#x610F;&#x5473;&#x7740;&#x4E0A;&#x6B21;&#x6267;&#x884C;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x7684;&#x4E2D;&#x9014;&#x53D1;&#x751F;&#x4E86;sql&#x9519;&#x8BEF;
                int last_executed_sql_task_count = task_index;
                for (std::unique_ptr&lt;SqlTask&gt; &amp;p_task : task_queue)
                {
                    if (last_executed_sql_task_count-- &gt; 0)continue;//&#x5DF2;&#x7ECF;&#x6267;&#x884C;&#x8FC7;&#x7684;sql&#x8DF3;&#x8FC7;
                    current_sqltask = p_task.get();
                    if (p_task-&gt;get_type() == SqlTaskType::Multi)
                    {
                        //&#x4E3A;&#x4E86;&#x4FDD;&#x6301;&#x4E00;&#x81F4;&#x6027;&#x5EFA;&#x7ACB;&#x4FDD;&#x5B58;&#x70B9;
                        save_point.reset(connection-&gt;setSavepoint(&quot;multi_task&quot;));
                        p_task-&gt;exec_sql(connection.get());
                        connection-&gt;releaseSavepoint(save_point.get());
                        save_point.reset(nullptr);
                    }
                    else
                    {
                        p_task-&gt;exec_sql(connection.get());
                    }
                    task_index++;
                }
                connection-&gt;commit();//&#x63D0;&#x4EA4;&#x4E8B;&#x52A1;
                current_sqltask = nullptr;

                //&#x5F00;&#x59CB;&#x5904;&#x7406;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF08;&#x5C31;&#x7B97;&#x6267;&#x884C;&#x5931;&#x8D25;&#x4E5F;&#x8FD0;&#x884C;callback&#xFF09;

                do
                {
                    task_queue.front()-&gt;exec_callback();
                    task_queue.pop_front();
                } while (!task_queue.empty());
                task_index = 0;

            }
            catch (const sql::SQLException &amp;e)
            {
                if (connection == nullptr)
                {
                    log.error(&quot;&#x6570;&#x636E;&#x5E93;&#x610F;&#x5916;&#x65AD;&#x5F00;&#xFF0C;&#x4E14;&#x91CD;&#x8FDE;&#x5931;&#x8D25;&#xFF0C;&#x4F11;&#x606F;5&#x79D2;&#x540E;&#x91CD;&#x8BD5;&quot;);
                    ThreadHelper::Sleep(5);
                }
                else if (connection-&gt;isValid())
                {
                    //&#x9047;&#x5230;&#x5F02;&#x5E38;&#xFF0C;&#x5148;&#x68C0;&#x67E5;&#x6570;&#x636E;&#x5E93;&#x94FE;&#x63A5;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x6548;
                    int error_code = e.getErrorCode();
                    switch (error_code)
                    {
                    case 1062:
                        log.errorAndNotifyAdmin(
                            fmt(&quot;&#x53D1;&#x751F;&#x4E3B;&#x952E;&#x91CD;&#x590D;&#x9519;&#x8BEF;&#xFF0C;&#x5F88;&#x6709;&#x53EF;&#x80FD;&#x662F;&#x6709;&#x4EBA;&#x4EBA;&#x4E3A;&#x4FEE;&#x6539;&#x4E86;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x8BE5;&#x64CD;&#x4F5C;&#x8DF3;&#x8FC7;&#xFF0C;&#x8BE6;&#x60C5;&#xFF1A;\n\t%1%&quot;) % errmsg(e));
                        task_index++;//&#x4E0B;&#x4E00;&#x8F6E;&#x8DF3;&#x8FC7;&#x8BE5;&#x4EFB;&#x52A1;
                        if (save_point != nullptr)//&#x5982;&#x679C;&#x6709;&#x4FDD;&#x5B58;&#x70B9;
                        {
                            connection-&gt;rollback(save_point.get());
                            connection-&gt;releaseSavepoint(save_point.get());
                            save_point = nullptr;
                        }
                        break;
                    default:
                        log.errorAndNotifyAdmin(fmt(&quot;&#x53D1;&#x751F;&#x4E86;&#x672A;&#x77E5;&#x9519;&#x8BEF;[%1%]&#x4F11;&#x606F;&#x4E00;&#x5206;&#x949F;&#x540E;&#x518D;&#x7EE7;&#x7EED;&#xFF0C;&#x8BE6;&#x60C5;&#xFF1A;\n\t%2%&quot;)%error_code % errmsg(e));                            
                        DMLSqlTask::ClearPreparedStatementCache();//&#x6E05;&#x9664;&#x9759;&#x6001;SqlTask&#x7F13;&#x5B58;
                        ThreadHelper::Sleep(60);//&#x4F11;&#x606F;&#x4E00;&#x5206;&#x949F;&#x540E;&#x518D;&#x7EE7;&#x7EED;&#xFF0C;&#x4E0D;&#x8DF3;&#x8FC7;
                        break;
                    }

                }            
                else
                {
                    log.error(fmt(&quot;&#x6267;&#x884C;&#x4E8B;&#x52A1;&#x7684;&#x671F;&#x95F4;&#x94FE;&#x63A5;&#x65AD;&#x5F00;&#xFF0C;&#x81EA;&#x7136;&#x56DE;&#x6EDA;&#xFF0C;&#x91CD;&#x505A;&#x4E4B;&#x524D;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x8BE6;&#x60C5;&#xFF1A;\n\t%1%&quot;)%errmsg(e));
                    task_index = 0;//&#x521D;&#x59CB;&#x5316;&#x4EFB;&#x52A1;&#x7D22;&#x5F15;
                    if (save_point != nullptr)
                    {
                        save_point.reset(nullptr);//&#x65AD;&#x5F00;&#x8FDE;&#x63A5;&#x540E;&#xFF0C;&#x4FDD;&#x5B58;&#x70B9;&#x81EA;&#x52A8;&#x5931;&#x6548;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x91CA;&#x653E;&#x64CD;&#x4F5C;
                    }
                }
            }
        }
    });
}
</code></pre>
<p>&#x81F3;&#x4E8E;&#x63D0;&#x4EA4;&#x4EFB;&#x52A1;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5165;&#x5217;&#x64CD;&#x4F5C;&#xFF0C;&#x5C31;&#x662F;&#x52A0;&#x4E86;&#x4E2A;&#x4E92;&#x65A5;&#x9501;&#x800C;&#x5DF2;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x7565;&#x8FC7;&#x4E86;&#x3002;</p>
<p>&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x5C0F;&#x8282;&#x4F1A;&#x8BB2;&#x4E00;&#x4E0B;SQL&#x4EFB;&#x52A1;&#x7C7B;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x3002;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="queryexp/exp2.html" class="navigation navigation-prev " aria-label="Previous page: 表达式编译器">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="database/sqltask.html" class="navigation navigation-next " aria-label="Next page: SQL任务">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"数据库管理类","level":"1.3.1.5.2","depth":4,"next":{"title":"SQL任务","level":"1.3.1.5.2.1","depth":5,"path":"logic/server/base/database/sqltask.md","ref":"logic/server/base/database/sqltask.md","articles":[]},"previous":{"title":"表达式编译器","level":"1.3.1.5.1.2","depth":5,"path":"logic/server/base/queryexp/exp2.md","ref":"logic/server/base/queryexp/exp2.md","articles":[]},"dir":"ltr"},"config":{"plugins":["luda-toggle-chapters","luda-sticky-header","mermaid-flow","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"livereload":{},"search":{},"luda-sticky-header":{"myConfigKey":"it's the default value"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"mermaid-flow":{},"highlight":{},"luda-toggle-chapters":{"myConfigKey":"it's the default value"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","bak":"mermaid-flow","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"logic/server/base/database.md","mtime":"2018-11-16T03:12:59.484Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-12-31T07:26:01.027Z"},"basePath":"../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../gitbook/gitbook.js"></script>
    <script src="../../../gitbook/theme.js"></script>
    
        
        <script src="../../../gitbook/gitbook-plugin-luda-toggle-chapters/luda-toggle-chapters.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-luda-sticky-header/luda-sticky-header.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

